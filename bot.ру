from telegram import InlineKeyboardButton, InlineKeyboardMarkup, Update
from telegram.ext import ApplicationBuilder, CommandHandler, CallbackQueryHandler, ContextTypes
import os

TOKEN = os.getenv("BOT_TOKEN")
ADMIN_ID = int(os.getenv("ADMIN_ID"))

CATALOG = {
    "–ö–∞—Ç–∞–ª–æ–≥": [
        ("–¢–æ–≤–∞—Ä 1", "1000‚ÇΩ"),
        ("–¢–æ–≤–∞—Ä 2", "1500‚ÇΩ"),
    ]
}

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    keyboard = [
        [InlineKeyboardButton(cat, callback_data=f"cat:{cat}")]
        for cat in CATALOG
    ]
    await update.message.reply_text(
        "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–∞—Ç–∞–ª–æ–≥ Golden Team üõç\n–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é:",
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def buttons(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    data = query.data

    if data.startswith("cat:"):
        cat = data.split(":")[1]
        keyboard = []
        for name, price in CATALOG[cat]:
            keyboard.append([
                InlineKeyboardButton(
                    f"{name} ‚Äî {price}",
                    callback_data=f"order:{name}:{price}"
                )
            ])
        await query.edit_message_text(
            f"üì¶ {cat}",
            reply_markup=InlineKeyboardMarkup(keyboard)
        )

    elif data.startswith("order:"):
        _, name, price = data.split(":")
        user = query.from_user

        text = (
            "üõí –ù–û–í–´–ô –ó–ê–ö–ê–ó\n\n"
            f"üë§ {user.full_name}\n"
            f"üì¶ {name}\n"
            f"üí∞ {price}\n"
            f"üÜî {user.id}"
        )

        await context.bot.send_message(chat_id=ADMIN_ID, text=text)
        await query.edit_message_text("‚úÖ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.")

def main():
    app = ApplicationBuilder().token(TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CallbackQueryHandler(buttons))
    app.run_polling()

if __name__ == "__main__":
    main()
